version: "3.8"

services:
  openclaw:
    build: .
    restart: always
    # Este comando ejecuta el programa una vez compilado
    command: ["node", "dist/index.js", "gateway", "--port", "18789", "--bind", "0.0.0.0"]
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - CLAWDBOT_GATEWAY_TOKEN=${CLAWDBOT_GATEWAY_TOKEN}
      - OPENCLAW_DEFAULT_MODEL=openai/gpt-4o
      - HOST=0.0.0.0
    networks:
      - dokploy-network
    volumes:
      - openclaw_data:/home/node/.openclaw
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=dokploy-network"
      - "traefik.http.routers.openclaw.rule=Host(`claw.undergroundstudio.io`)"
      - "traefik.http.routers.openclaw.entrypoints=websecure"
      - "traefik.http.routers.openclaw.tls.certresolver=letsencrypt"
      - "traefik.http.services.openclaw.loadbalancer.server.port=18789"

networks:
  dokploy-network:
    external: true

volumes:
  openclaw_data:
